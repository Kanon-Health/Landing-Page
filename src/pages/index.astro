---
import Layout from '~/layouts/Layout.astro';

const metadata = {
  title: 'Kanon | AI-Assisted Home Health',
};
---

<Layout metadata={metadata}>
  <section class="relative h-screen flex flex-col items-center justify-center overflow-hidden bg-slate-950 text-slate-200">
    <div class="absolute -top-24 -left-24 w-96 h-96 bg-cyan-500/10 rounded-full blur-[120px] pointer-events-none"></div>
    <div class="absolute -bottom-24 -right-24 w-96 h-96 bg-blue-600/10 rounded-full blur-[120px] pointer-events-none"></div>

    <main class="relative z-10 text-center px-6 max-w-4xl mx-auto">
      <h1 class="text-6xl md:text-8xl font-extrabold tracking-tighter mb-6 bg-gradient-to-b from-white to-slate-500 bg-clip-text text-transparent">
        KANON
      </h1>

      <p class="text-xl md:text-2xl text-cyan-400 font-semibold mb-4 tracking-wide uppercase">
        AI-Assisted Care. Audit-Proof Results.
      </p>

      <p class="max-w-2xl mx-auto text-slate-400 text-lg mb-12 leading-relaxed">
        Built for home health owners who demand audit safety and care teams who deserve a better workflow. 
        A modern EMR designed to eliminate administrative friction and secure your agency's future.
      </p>

      <div class="flex flex-col sm:flex-row gap-6 justify-center items-center">
        <button 
          id="open-modal"
          class="px-10 py-4 bg-white text-black font-bold rounded-full hover:scale-105 transition-all shadow-lg shadow-white/10 cursor-pointer"
        >
          Request Early Access
        </button>
        
        <div class="px-6 py-3 border border-slate-800 rounded-full text-slate-400 text-sm flex items-center gap-3 bg-slate-900/50">
          <span class="flex h-2 w-2 rounded-full bg-cyan-500 animate-pulse"></span>
          Now in Alpha
        </div>
      </div>
    </main>

    <footer class="absolute bottom-10 text-slate-600 text-xs tracking-widest uppercase">
      &copy; 2026 Kanon Health â€¢ Privacy-First Analytics Enabled
    </footer>
  </section>

  <div id="modal-overlay" class="fixed inset-0 z-50 hidden items-center justify-center bg-slate-950/80 backdrop-blur-sm p-4">
    <div class="bg-slate-900 border border-slate-800 w-full max-w-md p-8 rounded-3xl shadow-2xl relative">
      <button id="close-modal" class="absolute top-4 right-4 text-slate-500 hover:text-white text-2xl px-2">&times;</button>
      
      <h2 class="text-2xl font-bold mb-2 text-white">Join the Waitlist</h2>
      <p class="text-slate-400 mb-6 text-sm">Be the first to see how Kanon streamlines your workflow.</p>
      
      <form id="waitlist-form" class="space-y-4 text-left">
        <input type="text" name="name" required placeholder="Full Name" class="w-full bg-slate-950 border border-slate-800 rounded-xl px-4 py-3 text-slate-200 focus:outline-none focus:border-cyan-500">
        <input type="email" name="email" required placeholder="Email Address" class="w-full bg-slate-950 border border-slate-800 rounded-xl px-4 py-3 text-slate-200 focus:outline-none focus:border-cyan-500">
        <input type="text" name="role" required placeholder="Role (e.g. CEO)" class="w-full bg-slate-950 border border-slate-800 rounded-xl px-4 py-3 text-slate-200 focus:outline-none focus:border-cyan-500">
        <input type="text" name="company" required placeholder="Agency Name" class="w-full bg-slate-950 border border-slate-800 rounded-xl px-4 py-3 text-slate-200 focus:outline-none focus:border-cyan-500">
        
        <button type="submit" id="submit-btn" class="w-full py-4 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-xl transition-all">
          Secure Early Access
        </button>
      </form>
    </div>
  </div>

  <script is:inline>
    const openBtn = document.getElementById('open-modal');
    const closeBtn = document.getElementById('close-modal');
    const overlay = document.getElementById('modal-overlay');
    const form = document.getElementById('waitlist-form');
    const submitBtn = document.getElementById('submit-btn');

    // Toggle Modal
    openBtn.addEventListener('click', () => { overlay.classList.remove('hidden'); overlay.classList.add('flex'); });
    closeBtn.addEventListener('click', () => { overlay.classList.add('hidden'); overlay.classList.remove('flex'); });
    overlay.addEventListener('click', (e) => { if (e.target === overlay) { overlay.classList.add('hidden'); overlay.classList.remove('flex'); } });

    // Handle Form
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      submitBtn.innerText = 'Sending...';
      submitBtn.disabled = true;

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      // --- CLEAN DATE FORMATTING ---
      data.timestamp = new Date().toLocaleString('en-US', {
        month: 'short',
        day: 'numeric',
        year: 'numeric',
        hour: 'numeric',
        minute: '2-digit',
        hour12: true
      });

      try {
        const response = await fetch('https://capturelead-701766541051.us-east1.run.app', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });

        if (response.ok) {
          alert('Successfully joined the waitlist!');
          form.reset();
          overlay.classList.add('hidden');
        } else {
          alert('Submission failed. Try again.');
        }
      } catch {
        alert('Network error. Check connection.');
      } finally {
        submitBtn.innerText = 'Secure Early Access';
        submitBtn.disabled = false;
      }
    });
  </script>
</Layout>